@model IEnumerable<NAIMS.Models.Product>

@{
    ViewData["Title"] = "Index";
}

<style>
    .table-responsive.text-nowrap table {
        font-size: 14px;
    }
</style>

<h1>All Inventory</h1>

<p align=right>
    <a asp-action="Create" class="btn btn-dark">add new product</a>
</p>

<div class="card">
    <div class="table-responsive text-nowrap">
        <table class="table table-hover" id="prodTable">
            <thead>
                <tr>
                    <th class="sortable" onclick="sortTable(0)">
                        Barcode<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(1)">
                        SKU<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(2)">
                        Brand<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(3)">
                        Name<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(4)">
                        Size<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(5)">
                        Local<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(6)">
                        Status<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(7)">
                        Warehouse<i class="bx bx-sort"></i>
                    </th>
                    <th class="sortable" onclick="sortTable(8)">
                        Status<i class="bx bx-sort"></i>
                    </th>

                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.Barcode)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Sku)
                        </td>
                        <td>
                          @* bug *@
                            @if (item.BrandId == 1)
                            {
                                <text>milk_shake</text>
                            }
                            else if (item.BrandId == 2)
                            {
                                <text>depot</text>
                            }
                            else if (item.BrandId == 3)
                            {
                                <text>simply zen</text>
                            }
                            else
                            {
                                @Html.DisplayFor(modelItem => item.BrandId)
                            }

                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Pname)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Size)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.LocalQty)
                        </td>
                        <td>
                            @if (item.LocalStatus == "low stock")
                            {
                                <span class="badge rounded-pill bg-warning">@Html.DisplayFor(modelItem => item.LocalStatus)</span>
                            }
                            else if (item.LocalStatus == "pick up needed")
                            {
                                <span class="badge rounded-pill bg-danger">@Html.DisplayFor(modelItem => item.LocalStatus)</span>
                            }
                            else if (item.LocalStatus == "in stock")
                            {
                                <span class="badge rounded-pill bg-success">@Html.DisplayFor(modelItem => item.LocalStatus)</span>
                            }
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.WarehouseQty)
                        </td>
                        <td>
                            @if (item.WarehouseStatus == "low stock")
                            {
                                <span class="badge rounded-pill bg-warning">@Html.DisplayFor(modelItem => item.WarehouseStatus)</span>
                            }
                            else if (item.WarehouseStatus == "out of stock")
                            {
                                <span class="badge rounded-pill bg-danger">@Html.DisplayFor(modelItem => item.WarehouseStatus)</span>
                            }
                            else if (item.WarehouseStatus == "in stock")
                            {
                                <span class="badge rounded-pill bg-success">@Html.DisplayFor(modelItem => item.WarehouseStatus)</span>
                            }
                        </td>

                        <td>

                            <div class="dropdown">
                                <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i class="bx bx-dots-vertical-rounded"></i></button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" asp-action="Edit" asp-route-id="@item.ProductId"><i class="bx bx-edit-alt me-1"></i> Edit</a>
                                    <a class="dropdown-item" asp-action="Details" asp-route-id="@item.ProductId"><i class="bx bx-info-circle"></i> Details</a>
                                    <a class="dropdown-item" asp-action="Delete" asp-route-id="@item.ProductId"><i class="bx bx-trash me-1"></i> Delete</a>
                                </div>
                            </div>


                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<br />
<div class="pagination">
    <ul id="pagination" class="pagination"></ul>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        var table = '#prodTable';
        var rowsPerPage = 20;  // Number of rows to display per page
        var rows = $(table + ' tbody tr');
        var rowsCount = rows.length;
        var pageCount = Math.ceil(rowsCount / rowsPerPage);
        var numbers = $('#pagination');

        function updateTable(start, end) {
            $(table + ' tbody tr').hide().slice(start, end).show();
        }

        // Generate pagination buttons
        for (var i = 0; i < pageCount; i++) {
            numbers.append('<li class="page-item"><a class="page-link" href="#">' + (i + 1) + '</a></li>');
        }

        // Show first page initially
        $(table + ' tbody tr').hide();
        $(table + ' tbody tr').slice(0, rowsPerPage).show();
        $('#pagination li:first-child a').addClass('active');

        // Handle pagination click
        $('#pagination a').click(function (e) {
            e.preventDefault();
            $('#pagination a').removeClass('active');
            $(this).addClass('active');
            var page = $(this).text() - 1;
            var start = page * rowsPerPage;
            var end = start + rowsPerPage;
            updateTable(start, end);
        });
    });
    function sortTable(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("prodTable");
        switching = true;
        dir = "asc";
        while (switching) {
            switching = false;
            rows = table.rows;
            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchcount++;
            } else {
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
        updateSortIcons(n, dir);
    }

    function updateSortIcons(columnIndex, direction) {
        var headers = document.querySelectorAll(".sortable");
        headers.forEach(function (header, index) {
            var icon = header.querySelector("i");
            if (index === columnIndex) {
                if (direction === "asc") {
                    icon.className = "bx bx-sort-up";
                } else {
                    icon.className = "bx bx-sort-down";
                }
            } else {
                icon.className = "bx bx-sort";
            }
        });
    }
</script>


