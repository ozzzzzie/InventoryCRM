@model NAIMS.Models.SalesRepDashboardViewModel
@using Newtonsoft.Json

@{
    ViewData["Title"] = "Sales Dashboard";
    var pastelColors = new[] { "bg-light-blue", "bg-light-pink", "bg-light-green", "bg-light-yellow" };
    var totalTiles = 0;
}

<div class="container">
    <h1 class="my-4">Sales Dashboard</h1>

    <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 @pastelColors[totalTiles++ % pastelColors.Length]">
                <div class="card-body">
                    <h5 class="card-title">Orders This Month</h5>
                    <p class="card-text">@Model.OrdersThisMonth</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 @pastelColors[totalTiles++ % pastelColors.Length]">
                <div class="card-body">
                    <h5 class="card-title">Predicted Commission</h5>
                    <p class="card-text">@Model.PredictedCommission.ToString("0.000") BHD</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 @pastelColors[totalTiles++ % pastelColors.Length]">
                <div class="card-body">
                    <h5 class="card-title">Target Achievement</h5>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped bg-dark" role="progressbar" style="width: @(Math.Min(Model.TotalSalesThisMonth / Model.MonthlyTarget * 100, 100))%" aria-valuenow="@(Math.Min(Model.TotalSalesThisMonth / Model.MonthlyTarget * 100, 100))" aria-valuemin="0" aria-valuemax="100">
                            @((Model.TotalSalesThisMonth / Model.MonthlyTarget * 100).ToString("0.0"))%
                        </div>
                    </div><br />

                    <strong>@Model.EncouragingMessage</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-light">
                    Monthly Sales Overview
                </div>
                <div class="card-body">
                    <div id="sales-overview-chart"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        // monthly Sales Overview Chart
        var salesOverviewOptions = {
            chart: {
                type: 'area',
                height: 350,
                toolbar: { show: false }
            },
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth' },
            series: [{
                name: 'Total Sales',
                data: @Html.Raw(JsonConvert.SerializeObject(Model.MonthlyOverviews.Select(m => m.TotalSales).ToList()))
                    }],
            xaxis: {
                categories: @Html.Raw(JsonConvert.SerializeObject(Model.MonthlyOverviews.Select(m => m.Month).ToList()))
                    },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.9,
                    stops: [0, 90, 100]
                }
            },
            tooltip: { y: { formatter: val => val + " BHD" } }
        };
        var salesOverviewChart = new ApexCharts(document.querySelector("#sales-overview-chart"), salesOverviewOptions);
        salesOverviewChart.render();
    </script>
}

<style>
    .bg-light-blue {
        background-color: #cce5ff;
        color: #004085;
    }

    .bg-light-pink {
        background-color: #f8d7da;
        color: #721c24;
    }

    .bg-light-green {
        background-color: #d4edda;
        color: #155724;
    }

    .bg-light-yellow {
        background-color: #fff3cd;
        color: #856404;
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: bold;
    }

    .card-text {
        font-size: 1.5rem;
    }

    .badge {
        font-size: 1rem;
        padding: 0.5em 1em;
    }
</style>
