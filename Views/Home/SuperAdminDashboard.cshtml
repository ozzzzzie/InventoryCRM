@using Newtonsoft.Json
@model NAIMS.Models.SuperAdminDashboardViewModel

@{
    ViewData["Title"] = "Super Admin Dashboard";
    var pastelColors = new[] { "bg-light-blue", "bg-light-pink", "bg-light-green", "bg-light-yellow" };
    var totalTiles = 0;
}

<h1>Super Admin Dashboard</h1>

<div class="container">
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card h-100 @pastelColors[totalTiles++ % pastelColors.Length]">
                <div class="card-header">Total Orders This Month</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalOrders</h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100 @pastelColors[totalTiles++ % pastelColors.Length]">
                <div class="card-header">Total Sales This Month</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalSales.ToString("0.000") BHD</h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100 @pastelColors[totalTiles++ % pastelColors.Length]">
                <div class="card-header">Total Tax Collected This Year</div>
                <div class="card-body">
                    <h5 class="card-title">@Model.TotalTax.ToString("0.000") BHD</h5>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">Monthly Sales Overview</div>
                <div class="card-body">
                    <div id="monthlyOverviewChart"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">Sales Forecast</div>
                <div class="card-body">
                    <div id="salesForecastChart"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card h-100">
                <div class="card-header">Employee Performance</div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Employee Name</th>
                                <th>Sales</th>
                                <th>Target</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var performance in Model.EmployeePerformances)
                            {
                                <tr>
                                    <td>@performance.EmployeeName</td>
                                    <td>@performance.Sales.ToString("0.000") BHD</td>
                                    <td>@performance.Target.ToString("0.000") BHD</td>
                                    <td>
                                        @if (performance.HasReachedTarget)
                                        {
                                            <span class="badge bg-success">Reached</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger">Not Reached</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var monthlyOverviewOptions = {
                chart: {
                    type: 'area',
                    height: 350,
                    toolbar: { show: false }
                },
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth' },
                series: [{
                    name: 'Total Sales (BHD)',
                    data: @Html.Raw(JsonConvert.SerializeObject(Model.MonthlyOverviews.Select(m => m.TotalSales).ToList()))
                        }],
                xaxis: {
                    categories: @Html.Raw(JsonConvert.SerializeObject(Model.MonthlyOverviews.Select(m => m.Month).ToList())),
                    title: {
                        text: 'Month'
                    }
                },
                yaxis: {
                    title: {
                        text: 'Total Sales (BHD)'
                    }
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.9,
                        stops: [0, 90, 100]
                    }
                },
                tooltip: { y: { formatter: val => val + " BHD" } }
            };
            var monthlyOverviewChart = new ApexCharts(document.querySelector("#monthlyOverviewChart"), monthlyOverviewOptions);
            monthlyOverviewChart.render();

            var salesForecastOptions = {
                chart: {
                    type: 'area',
                    height: 350,
                    toolbar: { show: false }
                },
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth' },
                series: [{
                    name: 'Predicted Sales (BHD)',
                    data: @Html.Raw(JsonConvert.SerializeObject(Model.ASalesForecasts.Select(f => f.PredictedSales).ToList()))
                        }],
                xaxis: {
                    categories: @Html.Raw(JsonConvert.SerializeObject(Model.ASalesForecasts.Select(f => f.Month).ToList())),
                    title: {
                        text: 'Month'
                    }
                },
                yaxis: {
                    title: {
                        text: 'Predicted Sales (BHD)'
                    }
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.9,
                        stops: [0, 90, 100]
                    }
                },
                tooltip: { y: { formatter: val => val + " BHD" } }
            };
            var salesForecastChart = new ApexCharts(document.querySelector("#salesForecastChart"), salesForecastOptions);
            salesForecastChart.render();
        });
    </script>
}

<style>
    .bg-light-blue {
        background-color: #cce5ff;
        color: #004085;
    }

    .bg-light-pink {
        background-color: #f8d7da;
        color: #721c24;
    }

    .bg-light-green {
        background-color: #d4edda;
        color: #155724;
    }

    .bg-light-yellow {
        background-color: #fff3cd;
        color: #856404;
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: bold;
        color: #4d4d4d;
    }

    .card-text {
        font-size: 1.5rem;
        color: #4d4d4d;
    }

    .badge {
        font-size: 1rem;
        padding: 0.5em 1em;
    }
</style>
